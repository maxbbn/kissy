/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Apr 10 10:57
*/
KISSY.add("chart/axis",function(j,r){function p(e,a){this.chart=a;this.type=e.type;this.data=e;this.axisData=e.axis();this.current_x=-1;this.initEvent();j.each(this.axisData,function(c){c.name=c.name?c.name:false});this.initdata()}var k=j.Event;j.augment(p,j.EventTarget,{initYLabel:function(){var e=this.data.config,a=this.axisData;e=Math.ceil((this.chart.height-e.paddingBottom-e.paddingTop)/40);var c=this.data.y_max/e,b=[];for(i=0;i<=e;i++)b.push(c*i);a.y.labels=b},initdata:function(e){this.initYLabel();
var a=this.chart,c=a.width,b=a.height,f=this.data.config;e=this.axisData;a=e.x;e=e.y;var d=a.labels.length,g=e.labels.length;c=c-f.paddingRight;var h=f.paddingLeft,l=b-f.paddingBottom;f=f.paddingTop;var o=(l-f)/(g-1),m=c-h,n,q,s=Math.ceil(120*d/m);a._lpath={x:c*2-h,y:b-l+20};a._path=[];a._area=[];a._showlabel=[];for(i=0;i<d;i++){if(this.type==="line"){n=m/(d-1);b=h+i*n;q=i===0?b:b-n/2;n=i===d-1?b:b+n/2}else{n=m/d;b=h+(i+0.5)*n;q=b-n/2;n=b+n/2}a._showlabel.push(i===0||i%s===0);a._path.push({left:q,
right:n,top:f,bottom:l,x:b});a._area.push(new r.RectPath(q,f,n-q,l-f))}e._lpath={x:(l-f)/2+f,y:-10};e._path=[];for(i=0;i<g;i++)e._path.push({y:l-o*i,left:h,right:c})},initEvent:function(){if(this.type==="line"){k.on(this.chart,"mouse_move",this.chartMouseMove,this);k.on(this.chart,"mouse_leave",this.chartMouseLeave,this)}},destory:function(){if(this.type==="line"){k.remove(this.chart,"mouse_move",this.chartMouseMove);k.remove(this.chart,"mouse_leave",this.chartMouseLeave)}},chartMouseMove:function(e){var a=
this;j.each(a.axisData.x._area,function(c,b){if(b!==a.current_x&&c.inpath(e.x,e.y)){a.current_x=b;a.fire("xaxishover",{index:b,x:a.axisData.x._path[b].x});a.fire("redraw");return false}})},chartMouseLeave:function(){this.current_x=-1;this.fire("redraw");this.fire("leave")},draw:function(e){var a=this.data.config,c=this.data.axis(),b=c.x,f=c.y,d=b.labels.length,g=f.labels.length,h=this.chart.width,l=this.type==="line",o=this.type==="bar",m,n;e.save();for(m=0;m<g;m++){n=f._path[m];c=f.labels[m];if(m%
2===1&&m>0){e.save();e.fillStyle=a.axisBackgroundColor;e.fillRect(n.left,n.y,n.right-n.left,f._path[m-1].y-n.y);e.restore()}if(m!==0&&m!==g-1){e.strokeStyle=a.axisGridColor;e.lineWidth="1.0";e.beginPath();e.moveTo(n.left,n.y);e.lineTo(n.right,n.y);e.stroke()}if(c){e.font="12px Tohoma";e.textAlign="right";e.textBaseline="middle";e.fillStyle=a.axisTextColor;e.fillText(c,n.left-5,n.y)}}for(m=0;m<d;m++){g=m===this.current_x;f=b._path[m];c=b.labels[m];n=b._showlabel[m];e.strokeStyle=l&&g?"#404040":a.axisGridColor;
e.lineWidth=l&&g?"1.6":"1.0";if(o)if(m!==0){e.beginPath();e.moveTo(f.left,f.bottom);e.lineTo(f.left,f.top);e.stroke()}if(l)if(m!==0&&m!==d-1){e.beginPath();e.moveTo(f.x,f.bottom);e.lineTo(f.x,f.top);e.stroke()}if(c&&n){e.font="13px Tahoma";e.textAlign=l&&m===0?"left":l&&m===d-1?"right":"center";e.textBaseline="top";e.fillStyle=a.axisTextColor;e.fillText(c,f.x,f.bottom+5)}}if(this.current_x!==-1){f=b._path[this.current_x];c=b.labels[this.current_x];e.font="12px Tahoma";b=e.measureText(c).width+6;e.fillStyle=
"#333";d=Math.max(f.x-b/2,a.paddingLeft);d=Math.min(d,h-a.paddingRight-b);e.fillRect(d,f.bottom,b,20);e.textAlign="left";e.fillStyle="#ffffff";e.fillText(c,d+2,f.bottom+5)}e.restore();this.drawLabels(e)},drawLabels:function(e){var a=this.data.axis(),c=this.data.config,b=a.y.name,f=a.x.name,d=a.x._lpath;a=a.y._lpath;if(!(c.hideYAxisName&&c.hideXAxisName)){e.save();e.font="10px Arial";e.fillStyle="#808080";e.textAlign="center";e.textBaseline="middle";c.hideXAxisName||e.fillText("("+f+")",d.x,d.y);if(!c.hideYAxisName){e.rotate(Math.PI/
2);e.translate(a.x,a.y);e.fillText("("+b+")",0,0)}e.restore()}}});return p},{requires:["chart/path"]});
KISSY.add("chart/chart",function(j,r,p,k,e,a){function c(){this.list=[];this.current_index=-1;this.init()}function b(d,g){if(!(this instanceof b))return new b(d,g);var h=this.elCanvas=j.one(d);if(h){this.width=parseInt(h.attr("width"),10);this.height=parseInt(h.attr("height"),10);this.elCanvas=h;this.ctx=-1;this.tooltip=chartManager.getTooltip();if(g){this.data=g;this._initContext()}chartManager.add(this)}}var f={left:40,top:40};j.augment(c,j.EventTarget,{add:function(d){var g=this,h;g.list.push(d);
h=g.list.length-1;d.on("active",function(){g.current_index!==h&&g.fire("focusChange");g.current_index=h})},remove:function(d){d.detach("mouseenter");j.each(self.list,function(g,h){if(g===h)self.list[h]=null})},getTooltip:function(){if(!this.tooltip)this.tooltip=new k;return this.tooltip},init:function(){j.one("body").on("mousemove",this._bodyMouseMove,this);return this},_bodyMouseMove:function(d){var g,h;if(this.current_index>-1)g=this.list[this.current_index];if(g){h=d.pageX-g.offset.left;d=d.pageY-
g.offset.top;h>0&&h<g.width&&d>0&&d<g.height?g.fire("mouse_move",{x:h,y:d}):g.fire("mouse_leave")}}});j.mix(b,{addType:function(d){j.mix(b.types,d)},types:{}});j.extend(b,j.Base,{render:function(d){var g=this;if(d)g.data=d;if(g.ctx==-1){g.data=d;g._initContext()}else if(g.ctx!==0){g._drawcfg=j.merge(f,d.config,{width:g.width,height:g.height});g._data=new p(d,g._drawcfg);d=g._data;g.initChart();g.element=new b.types[d.type](d,this,g._drawcfg);g.layers.push(g.element);d=d.config;var h=g.ctx.createLinearGradient(0,
0,0,g.height);g.backgroundFillStyle=null;if(d.backgroundStyle&&typeof d.backgroundStyle==="object"){h.addColorStop(0,d.backgroundStyle.start);h.addColorStop(1,d.backgroundStyle.end);g.backgroundFillStyle=h}else if(j.isString(d.backgroundStyle))g.backgroundFillStyle=d.backgroundStyle;setTimeout(function(){g._redraw();g.initEvent()},100)}},_initContext:function(){var d=this;if(typeof d.ctx!="object")if(d.elCanvas[0].getContext)setTimeout(function(){d.ctx=d.elCanvas[0].getContext("2d");d._contextReady()},
0);else{d.ctx=0;d._count=typeof d._count=="number"?d._count-1:30;d._count>=0?setTimeout(function(){d._initContext()},50):j.one("<p class='ks-chart-error' >\u7cdf\u4e86\uff0c\u4f60\u7684\u6d4f\u89c8\u5668\u8fd8\u4e0d\u652f\u6301\u6211\u4eec\u7684\u56fe\u8868</p>").insertAfter(d.elCanvas)}},_contextReady:function(){this.data&&this.render(this.data)},loading:function(){this.showMessage("\u8f7d\u5165\u4e2d...")},showMessage:function(d){var g=this.ctx,h=this.width/2,l=this.height/2;g.clearRect(0,0,this.width,this.height);g.save();g.font="12px Arial";g.textAlign="center";g.fillStyle="#808080";g.fillText(d,
h,l);g.restore()},initChart:function(){this.layers=[];this._updateOffset();this.loading();if(this.element){this.element.destory();this.element=null}if(this._event_inited){this.elCanvas.detach("mouseenter",this._mouseenterHandle).detach("mouseleave",this._mouseLeaveHandle);this.detach()}this.tooltip.hide()},initEvent:function(){var d=this;d._event_inited=true;d.elCanvas.on("mouseenter",d._mouseenterHandle,d).on("mouseleave",d._mouseLeaveHandle,d);d.on("mouse_leave",d._drawAreaLeave,d);d.element.on("redraw",
d._redraw,d).on("showtooltip",function(g){g=j.isString(g.message)?g.message:g.message.innerHTML;d.tooltip.show(g)}).on("hidetooltip",function(){d.tooltip.hide()})},draw:function(){var d=this.ctx,g=this._drawcfg;if(this.backgroundFillStyle){d.fillStyle=this.backgroundFillStyle;d.fillRect(0,0,g.width,g.height)}else d.clearRect(0,0,g.width,g.height);j.each(this.layers,function(h){h.draw(d,g)})},ctx:function(){if(this.ctx)return this.ctx;if(this.elCanvas[0].getContext)return this.ctx=this.elCanvas.getContext("2d");
else return null},_redraw:function(){this._redrawmark=true;this._running||this._run()},_run:function(){var d=this;clearTimeout(d._timeoutid);d._running=true;d._redrawmark=false;d._timeoutid=setTimeout(function(){d.draw();if(d._redrawmark)d._run();else d._running=false},1E3/24)},_drawAreaLeave:function(){this.tooltip.hide()},_mouseenterHandle:function(){this._updateOffset();this.fire("active")},_updateOffset:function(){return this.offset=this.elCanvas.offset()},_mouseLeaveHandle:function(){this.fire("mouse_leave")}});
b.addType(e);b.addType(a);chartManager=window.chartManager=new c;return j.Chart=b},{requires:["chart/util","chart/data","chart/simpletooltip","chart/chart_line","chart/chart_bar"]});
KISSY.add("chart/chart_bar",function(j,r,p,k,e){function a(c,b,f){this.data=c;this.chart=b;this.drawcfg=f;this.config=c.config;this.initData(f);this.current=[-1,-1];this.anim=new r.Anim(this.config.animationDuration,this.config.animationEasing);this.axis=new k(c,b);this.frame=new e(b,c);this.anim.init();this.initEvent()}j.augment(a,j.EventTarget,{initData:function(){var c=this,b=c.chart,f=b.width;b=b.height;var d=c.data,g=d.config,h=d.elements().length,l=d.maxElementLength(),o=g.paddingTop,m=g.paddingLeft,
n=b-g.paddingBottom,q=(f-g.paddingRight-m)/l,s=q/5/h,u=q/3/h,w=(q-(h-1)*s-2*u)/h,z=[],y,C,t,D;c.maxLength=l;c.items=z;c.data.eachElement(function(G,A,v){if(v===-1)v=0;z[A]||(z[A]={_x:[],_top:[],_left:[],_path:[],_width:[],_height:[],_colors:[],_dcolors:[],_labels:[]});var B=z[A];y=(n-o)*G.data/d.y_max;C=m+v*q+u+A*(w+s);t=n-y;D=r.Color(c.data.getColor(A,"bar"));A=D.hslData();var E=A[2],F=A[1];E=(E+F/2)*0.6-F/2;colord=new r.Color.hsl(A[0],F,E);B._left[v]=C;B._top[v]=t;B._width[v]=w;B._height[v]=y;B._path[v]=
new p.RectPath(C,t,w,y);B._x[v]=C+w/2;B._colors[v]=D;B._dcolors[v]=colord;B._labels[v]=G.label})},draw:function(c){var b=this,f=b.items,d=b.maxLength,g,h,l,o,m,n,q=b.anim.get(),s;b.axis.draw(c);b.frame.draw(c);b.data.config.showLabels&&b.drawNames(c);j.each(f,function(u,w){for(s=0;s<d;s++){m=u._left[s];l=u._height[s];o=l*q;n=u._top[s]+l-o;barwidth=u._width[s];g=u._colors[s];dcolor=u._dcolors[s];h=c.createLinearGradient(m,n,m,n+o);h.addColorStop(0,g.css());h.addColorStop(1,dcolor.css());c.fillStyle=
h;c.fillRect(m,n,barwidth,o);if(d===1&&l>25){c.save();c.fillStyle="#fff";c.font="20px bold Arial";c.textBaseline="top";c.textAlign="center";element=b.data.elements()[w];c.fillText(r.numberFormat(element.data,element.format),u._x[s],n+2);c.restore()}}});q<1&&b.fire("redraw")},initEvent:function(){this.chart.on("mouse_move",this.chartMouseMove,this);this.chart.on("mouse_leave",this.chartMouseLeave,this)},destory:function(){this.chart.detach("mouse_move",this.chartMouseMove);this.chart.detach("mouse_leave",
this.chartMouseLeave)},chartMouseMove:function(c){var b=[-1,-1],f=this.items;j.each(this.items,function(d,g){j.each(d._path,function(h,l){if(h.inpath(c.x,c.y))b=[g,l]})});if(!(b[0]===this.current[0]&&b[1]===this.current[1])){this.current=b;if(b[0]+b[1]>=0){this.fire("barhover",{index:b});this.fire("showtooltip",{top:f[b[0]]._top[b[1]],left:f[b[0]]._x[b[1]],message:this.getTooltip(b)})}else this.fire("hidetooltip")}},chartMouseLeave:function(){this.current=[-1,-1]},getTooltip:function(c){var b=c[1];
c=this.items[c[0]];return"<div class='bartip'><span style='color:"+c._colors[b].css()+";'>"+c._labels[b]+"</span></div>"},drawNames:function(c){var b=this.chart.width,f=this.data,d=this.data.elements(),g=f.config,h=d.length-1;b=b-g.paddingRight;g=g.paddingTop-12;for(var l,o;h>=0;h--){l=d[h];if(!l.notdraw){o=f.getColor(h);c.save();c.textAlign="end";c.textBaseline="middle";c.fillStyle="#808080";c.font="12px Arial";c.fillText(l.name,b,g);b-=c.measureText(l.name).width+10;c.restore();c.save();c.beginPath();
c.fillStyle=o;c.arc(b,g,5,0,Math.PI*2,true);c.closePath();c.fill();c.restore();b-=10}}}});return{bar:a}},{requires:["chart/util","chart/path","chart/axis","chart/frame"]});
KISSY.add("chart/chart_line",function(j,r,p,k){function e(a,c,b){this.chart=c;this.data=a;this.elements=a.elements();this._current=-1;this.config=a.config;this.drawcfg=b;this.initdata(b);this._ready_idx=-1;this.anim=new r.Anim(this.config.animationDuration,this.config.animationEasing);this.axis=new p(a,c,b);this.frame=new k(c,a);this.anim.init();this.init()}j.augment(e,j.EventTarget,{initdata:function(){var a=this.data,c=this.chart,b=c.width,f=c.height,d=a.config;c=a.maxElementLength();var g=d.paddingLeft,
h=a.y_max,l=f-d.paddingBottom;f=l-d.paddingTop;b=b-d.paddingRight-g;var o=b/(c-1),m=[];this.items=m;a.eachElement(function(n,q,s){m[q]||(m[q]={_points:[],_labels:[],_color:a.getColor(q),_maxtop:l,_drawbg:q===d.drawbg,_notdraw:n.notdraw});q=m[q];ptop=Math.max(l-n.data/h*f,d.paddingTop-5);q._maxtop=Math.min(q._maxtop,ptop);q._labels[s]=n.label;q._points[s]={x:g+o*s,y:ptop,nodata:n.data===null,bottom:l}})},draw:function(a,c){var b=this,f=b.data,d=f.config,g=d.paddingLeft,h=c.width-d.paddingRight,l=c.height-
d.paddingBottom,o,m,n,q,s,u,w=b.anim.get(),z;b.axis.draw(a,c);b.frame.draw(a,c);f.config.showLabels&&b.drawNames(a,c);if(w>=1&&this._ready_idx<b.items.length-1){b._ready_idx++;b.anim.init();w=b.anim.get()}if(this._ready_idx!==f.elements().length-1||w!==1)this.fire("redraw");j.each(b.items,function(y,C){var t;if(!y._notdraw){u=C!==b._ready_idx?C>b._ready_idx?0:1:w;o=y._color;n=y._points;if(y._drawbg){a.save();a.globalAlpha=0.4;maxtop=l-(l-y._maxtop)*u;z=a.createLinearGradient(g,maxtop,g,l);z.addColorStop(0,
o);z.addColorStop(1,"rgb(255,255,255)");a.fillStyle=z;a.beginPath();a.moveTo(g,l);for(q=0;q<n.length;q++){t=n[q];m=l-(l-t.y)*u;a.lineTo(t.x,m)}a.lineTo(h,l);a.stroke();a.fill();a.restore()}a.save();s=n.length;a.strokeStyle=o;a.lineWidth=2;a.beginPath();for(q=0;q<s;q++){t=n[q];if(!t.nodata){m=l-(l-t.y)*u;q===0?a.moveTo(t.x,m):a.lineTo(t.x,m)}}a.stroke();a.restore();a.save();for(q=0;q<s;q++){t=n[q];if(!t.nodata){m=l-(l-t.y)*u;a.fillStyle=o;a.beginPath();a.arc(t.x,m,5,0,Math.PI*2,true);a.closePath();
a.fill();if(q!==b._current){a.fillStyle="#fff";a.beginPath();a.arc(t.x,m,3,0,Math.PI*2,true);a.closePath();a.fill()}}}a.restore()}})},init:function(){this._ready_idx=0;this.axis.on("xaxishover",this._axis_hover,this).on("leave",this._axis_leave,this).on("redraw",this._redraw,this)},destory:function(){this.axis.detach("xaxishover",this._axis_hover).detach("leave",this._axis_leave).detach("redraw",this._redraw)},_redraw:function(){this.fire("redraw")},_axis_hover:function(a){a=a.index;if(this._current!==
a){this._current=a;this.fire("redraw");this.fire("showtooltip",{message:this.getTooltip(a)})}},_axis_leave:function(){this._current=-1;this.fire("redraw")},getTooltip:function(a){var c,b;c="<ul>";j.each(this.items,function(f){if(!f._points[a].nodata){b='<li><p style="color:'+f._color+'">'+f._labels[a]+"</p></li>";c+=b}});c+="</ul>";return c},drawNames:function(a){var c=this.chart.width,b=this.data,f=b.config;b=b.elements();var d=b.length-1;c=c-f.paddingRight;f=f.paddingTop-12;var g,h;for(console.log(b);d>=
0;d--){g=b[d];if(!g.notdraw){h=this.data.getColor(d);a.save();a.textAlign="end";a.textBaseline="middle";a.fillStyle="#808080";a.font="12px Arial";a.fillText(g.name,c,f);c-=a.measureText(g.name).width+10;a.restore();a.save();a.beginPath();a.fillStyle=h;a.arc(c,f,5,0,Math.PI*2,true);a.closePath();a.fill();a.restore();c-=10}}}});return{line:e}},{requires:["chart/util","chart/axis","chart/frame"]});
KISSY.add("chart/data",function(j,r){function p(a,c){if(a&&a.type){if(!this instanceof p)return new p(a);var b=a.config;this.origin=a;a=j.clone(a);this.type=a.type.toLowerCase();this.config=b=j.merge(k,e[this.type],b);j.each({left:"paddingLeft",top:"paddingTop",bottom:"paddingBottom",right:"paddingRight"},function(f,d){if(d in b&&j.isNumber(b[d]))b[f]=b[d]});this._elements=this._expandElement(this._initElement(a));this._initElementItem();this._axis=a.axis;this.y_max=this.getMax(this.max(),c)}}var k=
{paddingTop:30,paddingLeft:40,paddingRight:20,paddingBottom:20,showLabels:true,colors:[],animationDuration:0.5,animationEasing:"easeInStrong",hideYAxisName:false,hideXAxisName:true,backgroundStyle:false,axisTextColor:"#999",axisBackgroundColor:"rgba(238, 238, 238, 0.4)",axisGridColor:"#e4e4e4",numberFormat:null,frameColor:"#d7d7d7"},e={line:{drawbg:-1},bar:{},pie:{animationDuration:1.8,animationEasing:"bounceOut",paddingTop:10,paddingBottom:10,paddingLeft:10,paddingRight:10,drawShadow:true,shadow:{blur:3,
color:"#000"},labelTemplate:"{name} {pecent}%",firstPieOut:false}};j.augment(p,{axis:function(){return this._axis},elements:function(){return this._elements},maxElementLength:function(){var a=0;j.each(this._elements,function(c){a=j.isArray(c.items)?Math.max(a,c.items.length):Math.max(a,1)});return a},getColor:function(a,c){var b=this._elements.length,f=this.config.colors;if(j.isArray(f)&&f[a])return f[a];if(j.isFunction(f))return f(a);return this.getDefaultColor(a,b,c)},sum:function(){var a=0;this.eachElement(function(c){a+=
c.data});return a},max:function(){return this._max},getMax:function(a,c){var b=this.config;b=Math.ceil((c.height-b.paddingBottom-b.paddingTop)/40);var f=a/b,d;if(f<=1)f=1;else if(f>1&&f<=5)f=Math.ceil(f);else if(f>5&&f<=10)f=10;else{d=1;do{d*=10;f/=10}while(f>10);f=Math.ceil(f)*d}return f*b},getDefaultColor:function(a,c){var b=1/3,f=b*a,d,g;if(a<3)f=b*a+0.05;else{if(c%3==0)if(a===c-1)a=c-2;else if(a===c-2)a=c-1;f=a%3;d=Math.ceil(c/3);g=Math.ceil((a+1)/3);f=f*b+b/d*(g-1)}return r.Color.hsl(f,0.7,0.65).hexTriplet()},
eachElement:function(a){j.each(this._elements,function(c,b){c.items?j.each(c.items,function(f,d){a(f,b,d)}):a(c,b,-1)})},_initElement:function(a){var c=null,b;if(a.elements&&j.isArray(a.elements))c=j.clone(a.elements);if(!a.elements&&a.element&&j.isArray(a.element.names)){c=[];b=a.element;j.each(b.names,function(f,d){c.push({name:f,data:j.isArray(b.datas)?b.datas[d]:null,label:j.isArray(b.labels)?b.labels[d]:b.label})})}return c},_expandElement:function(a){j.each(a,function(c){if(j.isArray(c.datas)){c.items=
[];j.each(c.datas,function(b,f){var d={name:c.name,data:b};d.label=j.isArray(c.labels)?c.labels[f]:c.label;c.items.push(d)})}});return a},_initElementItem:function(){var a=this;a._max=0;a.eachElement(function(c,b,f){if(b===0&&!f)a._max=c.data||0;c.data=j.isNumber(c.data)?c.data:null;a._max=Math.max(a._max,c.data);if(j.isArray(a.config.numberFormat))c.format=a.config.numberFormat[b];else if(j.isString(a.config.numberFormat))c.format=a.config.numberFormat;if(typeof c.format=="undefined")c.format=a.config.numberFormat;
c.label=j.substitute(typeof c.label==="undefined"?null:c.label,{name:c.name,data:c.format&&typeof c.data==="number"?r.numberFormat(c.data,c.format):c.data});c.notdraw=a._elements[b].notdraw})}});return p},{requires:["chart/util"]});
KISSY.add("chart/element",function(j,r,p,k){function e(){}j.mix(e,{getElement:function(a,c,b){var f;switch(a.type){case "line":f=k;break;case "pie":f=r;break;case "bar":f=p}return new f(a,c,b)},getMax:function(a){var c=a[0].data[0],b,f=a.length,d,g;for(b=0;b<f;b++){element=a[b];d=0;for(g=element.data.length;d<g;d++)c=Math.max(c,element.data[d]||0)}return c}});j.augment(e,j.EventTarget,{drawNames:function(a){var c=this.drawcfg,b=this.data.elements(),f=b.length-1,d=c.width-c.paddingRight;c=c.paddingTop-
12;for(var g,h;f>=0;f--){g=b[f];if(!g.notdraw){h=this.data.getColor(f);a.save();a.textAlign="end";a.textBaseline="middle";a.fillStyle="#808080";a.font="12px Arial";a.fillText(g.name,d,c);d-=a.measureText(g.name).width+10;a.restore();a.save();a.beginPath();a.fillStyle=h;a.arc(d,c,5,0,Math.PI*2,true);a.closePath();a.fill();a.restore();d-=10}}},init:function(){},destory:function(){},draw:function(){}});return e},{requires:["chart/element_pie","chart/element_bar","chart/element_line"]});
KISSY.add("chart/element_pie",function(j,r){function p(e){if(j.isString(e))e=r.Color(e);e=e.hslData();var a=e[1],c=e[2];c=(c+a*0.5)*1.05-a*0.5;return new r.Color.hsl(e[0],a,c)}function k(e,a,c){this.data=e;this.chart=a;this.type=0;this.config=e.config;this.drawcfg=c;this.initdata(c);this.init();this.anim=new r.Anim(this.config.animationDuration,this.config.animationEasing);this.anim.init()}j.augment(k,j.EventTarget,{initdata:function(e){var a=this,c=a.data,b=0,f,d,g,h;a._x=c.config.showLabels?e.width*
0.618/2:e.width/2;a._y=e.height/2;a._r=Math.min(e.height-e.paddingTop-e.paddingBottom,e.width-e.paddingLeft-e.paddingRight)/2;a._r=Math.min(a._r,a._x-e.paddingLeft);a._lx=e.width*0.618;a.angleStart=-Math.PI/4;a.antiClock=true;a.items=[];a._currentIndex=-1;b=c.sum();h=0;j.each(c.elements(),function(l,o){g=l.data/b;f=h+g;d=c.getColor(o);a.items.push({start:h,end:f,color:d,color2:p(d).css(),textColor:"#999",labelRight:e.width-50,labelY:50+20*o});h=f;if(o===0)a.angleStart+=g*Math.PI})},drawLabels:function(e){var a=
this,c=a.data,b=a.items,f,d=c.sum(),g,h,l;e.save();e.textBaseline="middle";e.textAlign="right";c.eachElement(function(o,m){f=b[m];l=f.labelY;h=f.labelRight;e.fillStyle=b[m].color;e.beginPath();e.moveTo(h,l);e.font="15px sans-serif";e.fillRect(h-10,l-5,10,10);e.closePath();e.fillStyle=b[m].textColor;g=j.substitute(a.config.labelTemplate,{data:r.numberFormat(o.data,o.format),name:o.name,pecent:r.numberFormat(o.data/d*100,"0.00")});e.fillText(g,h-15,l)});e.restore()},draw:function(e){var a=this,c=a._x,
b=a._y,f=a._r,d,g,h=a.anim.get(),l=a.data.config;h<1&&a.fire("redraw");l.showLabels&&a.drawLabels(e);e.save();if(l.drawShadow){e.shadowBlur=l.shadow.blur;e.shadowColor=l.shadow.color}e.save();e.lineWidth=0.5;e.strokeStyle="#fff";j.each(a.items,function(o,m){d=o.start*h*2*Math.PI;g=o.end*h*2*Math.PI;e.save();e.fillStyle=m===a._currentIndex?o.color2:o.color;e.beginPath();o._currentStart=a.antiClock?a.angleStart-d:a.angleStart+d;o._currentEnd=a.antiClock?a.angleStart-g-0.0050:a.angleStart+g+0.0050;if(m===
0&&h>=1&&l.firstPieOut){e.moveTo(c+2,b-2);e.arc(c+2,b-2,f,o._currentStart,o._currentEnd,a.antiClock)}else{e.moveTo(c,b);e.arc(c,b,f,o._currentStart,o._currentEnd,a.antiClock)}e.closePath();e.fill();e.restore()});e.restore();e.restore()},init:function(){this.chart.on("mouse_move",this.chartMouseMove,this);this.chart.on("mouse_leave",this.chartMouseLeave,this)},destory:function(){this.chart.detach("mouse_move",this.chartMouseMove);this.chart.detach("mouse_leave",this.chartMouseLeave)},chartMouseMove:function(e){var a=
this._r,c=e.x-this._x,b=e.y-this._y,f;e=this.items;if(c*c+b*b>a*a){this.fire("hidetooltip");this._currentIndex=-1;this.fire("redraw")}else{if(c!=0){a=Math.atan(b/c);if(b<0&&c>0)a+=2*Math.PI;if(c<0)a+=Math.PI}else a=b>=0?Math.PI/2:3*Math.PI/2;for(i=e.length-1;i>=0;i--){b=e[i];c=b._currentStart;b=b._currentEnd;if(c>b){f=c;c=b;b=f}f=b-c;c%=Math.PI*2;if(c<0)if(c+f<0||a>Math.PI)c+=Math.PI*2;if(a>c&&a<c+f&&i!==this._currentIndex){this._currentIndex=i;this.fire("redraw");this.fire("showtooltip",{message:this.data.elements()[i].label})}}}},
chartMouseLeave:function(){this._currentIndex=-1;this.fire("hidetooltip");this.fire("redraw")}});return k},{requires:["chart/util"]});KISSY.add("chart/frame",function(j,r){function p(k,e){var a=e.config,c=k.width,b=k.height;this.data=e;this.path=new r.RectPath(a.paddingLeft,a.paddingTop,c-a.paddingRight-a.paddingLeft,b-a.paddingBottom-a.paddingTop)}j.augment(p,{draw:function(k){k.save();k.strokeStyle=this.data.config.frameColor;k.lineWidth=2;this.path.draw(k);k.stroke();k.restore()}});return p},{requires:["chart/path"]});
KISSY.add("chart",function(j,r){return r},{requires:["chart/chart"]});
KISSY.add("chart/path",function(j){function r(){}function p(e,a,c,b){this.rect={x:e,y:a,w:c,h:b}}function k(e,a,c,b,f,d){this._arc={x:e,y:a,r:c,b:b,e:f,a:d}}j.augment(r,{draw:function(){},inpath:function(){}});j.extend(p,r,{draw:function(e){var a=this.rect;e.beginPath();e.rect(a.x,a.y,a.w,a.h)},inpath:function(e,a){var c=this.rect,b=c.x,f=c.y,d=b+c.w;c=f+c.h;return e>b&&e<d&&a>f&&a<c}});j.extend(k,r,{draw:function(e){var a=this._arc;e.beginPath();e.moveTo(a,x,a.y);e.arc(a.x,a.y,a.r,a.b,a.e,a.a);e.closePath()},
inpath:function(e,a,c){if(c){this.draw(c);return c.isPointInPath(e,a)}a=this._arc;c=e-a.x;e=e-a.y;if(!(Math.pow(c,2)+Math.pow(e,2)<=Math.pow(a.r,2)))return false;if(c===0)if(e===0)return false;else da=e>0?Math.PI/2:Math.PI*1.5}});return{Path:r,RectPath:p,ArcPath:k}});
KISSY.add("chart/simpletooltip",function(j){function r(){var p=this;p.n_c=j.all("<div class='ks-chart-tooltip'>");p._offset={left:0,top:0};p.hide();j.ready(function(){j.one("body").append(p.n_c).on("mousemove",p._mousemove,p)})}j.augment(r,{_mousemove:function(p){var k=p.pageX;p=p.pageY;if(this._show)this._updateOffset(k,p);else{this._offset.left=k;this._offset.top=p}},_updateOffset:function(p,k){var e=j.DOM;if(p>e.scrollLeft()+e.viewportWidth()-100)p-=this.n_c.width()+6;if(k>e.scrollTop()+e.viewportHeight()-
100)k-=this.n_c.height()+20;this.n_c.offset({left:p,top:k+12})},show:function(p){this._show=true;this.n_c.html(p).css("display","block")},hide:function(){this._show=false;this.n_c.css("display","none")},_init:function(){}});return r});
KISSY.add("chart/util",function(j){function r(k,e){this.duration=k*1E3;this.fnEasing=j.isString(e)?j.Easing[e]:e}var p=function(){var k=function b(f,d,g,h){var l=arguments.length;if(l<3){if(typeof f==="string"){f=f.substr(f.indexOf("#")+1);var o=f.length===3;f=parseInt(f,16);o&&(f=(f&3840)*4352|(f&240)*272|(f&15)*17)}l===2&&(h=d);d=(f&65280)/256;g=f&255;f>>>=16}if(!(this instanceof b))return new b(f,d,g,h);this.channels=[typeof f==="string"&&parseInt(f,16)||f,typeof d==="string"&&parseInt(d,16)||
d,typeof g==="string"&&parseInt(g,16)||g,typeof h!=="string"&&typeof h!=="number"&&1||typeof h==="string"&&parseFloat(h)||h]},e=k.prototype,a=Math,c;k.RGBtoHSL=function(b){var f=b[0],d=b[1];b=b[2];f/=255;d/=255;b/=255;var g=a.max(f,d,b),h=a.min(f,d,b),l,o=(g+h)/2;if(g===h)l=h=0;else{var m=g-h;h=o>0.5?m/(2-g-h):m/(g+h);switch(g){case f:l=(d-b)/m+(d<b?6:0);break;case d:l=(b-f)/m+2;break;case b:l=(f-d)/m+4}l/=6}return[l,h,o]};k.HSLtoRGB=function(b){var f=b[0],d=b[1],g=b[2];b=function(o,m,n){if(n<0)n+=
1;if(n>1)n-=1;if(n<1/6)return o+(m-o)*6*n;if(n<0.5)return m;if(n<2/3)return o+(m-o)*(2/3-n)*6;return o};if(d===0)d=g=f=g;else{var h=g<0.5?g*(1+d):g+d-g*d,l=2*g-h;d=b(l,h,f+1/3);g=b(l,h,f);f=b(l,h,f-1/3)}return[d*255,g*255,f*255]};k.rgb=function(b,f,d,g){return new k(b,f,d,typeof g!=="undefined"?g:1)};k.hsl=function(b,f,d,g){b=k.HSLtoRGB([b,f,d]);f=a.ceil;return new k(f(b[0]),f(b[1]),f(b[2]),typeof g!=="undefined"?g:1)};k.TO_STRING_METHOD="hexTriplet";k.parse=function(b){b=b.replace(/^\s+/g,"").toLowerCase();
if(b[0]==="#")return new k(b);var f=b.substr(0,3),d;b=b.replace(/[^\d,.]/g,"").split(",");for(d=b.length;d--;)b[d]=b[d]&&parseFloat(b[d])||0;switch(f){case "rgb":return k.rgb.apply(k,b);case "hsl":b[0]/=360;b[1]/=100;b[2]/=100;return k.hsl.apply(k,b)}return null};(k.clearColors=function(){c={transparent:[0,0,0,0]}})();k.define=function(b,f){c[b.toLowerCase()]=f};k.get=function(b){b=b.toLowerCase();if(Object.prototype.hasOwnProperty.call(c,b))return k.apply(null,[].concat(c[b]));return null};k.del=
function(b){return delete c[b.toLowerCase()]};k.random=function(b,f){typeof b==="string"&&(b=k.get(b))&&(b=b.getValue());typeof f==="string"&&(f=k.get(f))&&(f=f.getValue());var d=a.floor,g=a.random;f=(f||16777215)+1;if(!isNaN(b))return new k(d(g()*(f-b)+b));return new k(d(g()*f))};e.toString=function(){return this[k.TO_STRING_METHOD]()};e.valueOf=e.getValue=function(){var b=this.channels;return b[0]*65536|b[1]*256|b[2]};e.setValue=function(b){this.channels.splice(0,3,b>>>16,(b&65280)/256,b&255)};
e.hexTriplet="01".substr(-1)==="1"?function(){return"#"+("00000"+this.getValue().toString(16)).substr(-6)}:function(){var b=this.getValue().toString(16);return"#"+Array(b.length<6?6-b.length+1:0).join("0")+b};e.css=function(){return this.channels[3]===1?this.hexTriplet():this.rgba()};e.rgbData=function(){return this.channels.slice(0,3)};e.hslData=function(){return k.RGBtoHSL(this.rgbData())};e.rgb=function(){return"rgb("+this.rgbData().join(",")+")"};e.rgba=function(){return"rgba("+this.channels.join(",")+
")"};e.hsl=function(){var b=this.hslData();return"hsl("+b[0]*360+","+b[1]*100+"%,"+b[2]*100+"%)"};e.hsla=function(){var b=this.hslData();return"hsla("+b[0]*360+","+b[1]*100+"%,"+b[2]*100+"%,"+this.channels[3]+")"};return k}();j.augment(r,{init:function(){this.start=(new Date).getTime();this.finish=this.start+this.duration},get:function(){var k=(new Date).getTime();if(k>this.finish)return 1;return this.fnEasing((k-this.start)/this.duration)}});return{Color:p,numberFormat:function(k,e){if(typeof e===
"string"){var a=-1<e.indexOf(","),c=e.split(".");if(1<c.length)k=k.toFixed(c[1].length);else if(2<c.length)throw"NumberFormatException: invalid format, formats should have no more than 1 period:"+e;else k=k.toFixed(0);var b=k.toString();if(a){c=b.split(".");a=c[0];b=[];for(var f=a.length,d=Math.floor(f/3),g=a.length%3||3,h=0;h<f;h+=g){if(h!=0)g=3;b[b.length]=a.substr(h,g);d-=1}b=b.join(",");if(c[1])b+="."+c[1]}return e.replace(/[\d,?\.?]+/,b)}},Anim:r}});
