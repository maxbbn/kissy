/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Apr 5 17:13
*/
KISSY.add("chart/axis",function(l,q){function p(a,b,d){this.chart=b;this.type=a.type;this.data=a;this.axisData=a.axis();this.cfg=d;this.current_x=-1;this.initEvent();l.each(this.axisData,function(c){c.name="name"in c&&l.isString(c)&&c.name.length>0?"("+c.name+")":false});this.initdata(this.axisData,d)}var h=l.Event;l.mix(p,{getMax:function(a,b){var d=Math.ceil((b.height-b.paddingBottom-b.paddingTop)/40),c=a/d,f;if(c<=1)c=1;else if(c>1&&c<=5)c=Math.ceil(c);else if(c>5&&c<=10)c=10;else{f=1;do{f*=10;
c/=10}while(c>10);c=Math.ceil(c)*f}return c*d}});l.augment(p,l.EventTarget,{initYLabel:function(a,b){if(a.y.labels)return null;var d=Math.ceil((b.height-b.paddingBottom-b.paddingTop)/40),c=b.max/d,f=[];for(i=0;i<=d;i++)f.push(c*i);a.y.labels=f},initdata:function(a,b){this.initYLabel(a,b);var d=a.x,c=a.y,f=d.labels.length,j=c.labels.length,e=b.height,g=b.width-b.paddingRight,k=b.paddingLeft,m=e-b.paddingBottom,n=b.paddingTop,o=(m-n)/(j-1),t=g-k,r,u,y=Math.ceil(120*f/t);d._lpath={x:g*2-k,y:e-m+20};
d._path=[];d._area=[];d._showlabel=[];for(i=0;i<f;i++){if(this.type==="line"){r=t/(f-1);e=k+i*r;u=i===0?e:e-r/2;r=i===f-1?e:e+r/2}else{r=t/f;e=k+(i+0.5)*r;u=e-r/2;r=e+r/2}d._showlabel.push(i===0||i%y===0);d._path.push({left:u,right:r,top:n,bottom:m,x:e});d._area.push(new q.RectPath(u,n,r-u,m-n))}c._lpath={x:(m-n)/2+n,y:-10};c._path=[];for(i=0;i<j;i++)c._path.push({y:m-o*i,left:k,right:g})},initEvent:function(){if(this.type==="line"){h.on(this.chart,"mouse_move",this.chartMouseMove,this);h.on(this.chart,
"mouse_leave",this.chartMouseLeave,this)}},destory:function(){if(this.type==="line"){h.remove(this.chart,"mouse_move",this.chartMouseMove);h.remove(this.chart,"mouse_leave",this.chartMouseLeave)}},chartMouseMove:function(a){var b=this;l.each(b.axisData.x._area,function(d,c){if(c!==b.current_x&&d.inpath(a.x,a.y)){b.current_x=c;b.fire("xaxishover",{index:c,x:b.axisData.x._path[c].x});b.fire("redraw");return false}})},chartMouseLeave:function(){this.current_x=-1;this.fire("redraw");this.fire("leave")},
draw:function(a,b){var d=this.data.config,c=this.data.axis(),f=c.x,j=c.y,e=f.labels.length,g=j.labels.length,k=this.type==="line",m=this.type==="bar",n,o;a.save();for(n=0;n<g;n++){o=j._path[n];c=j.labels[n];if(n%2===1&&n>0){a.save();a.globalAlpha=0.3;a.fillStyle=d.axisBackgroundColor;a.fillRect(o.left,o.y,o.right-o.left,j._path[n-1].y-o.y);a.restore()}if(n!==0&&n!==g-1){a.strokeStyle=d.axisGridColor;a.lineWidth="1.0";a.beginPath();a.moveTo(o.left,o.y);a.lineTo(o.right,o.y);a.stroke()}if(c){a.font=
"12px Tohoma";a.textAlign="right";a.textBaseline="middle";a.fillStyle=d.axisTextColor;a.fillText(c,o.left-5,o.y)}}for(n=0;n<e;n++){g=n===this.current_x;j=f._path[n];c=f.labels[n];o=f._showlabel[n];a.strokeStyle=k&&g?"#404040":d.axisGridColor;a.lineWidth=k&&g?"1.6":"1.0";if(m)if(n!==0){a.beginPath();a.moveTo(j.left,j.bottom);a.lineTo(j.left,j.top);a.stroke()}if(k)if(n!==0&&n!==e-1){a.beginPath();a.moveTo(j.x,j.bottom);a.lineTo(j.x,j.top);a.stroke()}if(c&&o){a.font="13px Tahoma";a.textAlign=k&&n===
0?"left":k&&n===e-1?"right":"center";a.textBaseline="top";a.fillStyle=d.axisTextColor;a.fillText(c,j.x,j.bottom+5)}}if(this.current_x!==-1){j=f._path[this.current_x];c=f.labels[this.current_x];a.font="12px Tahoma";f=a.measureText(c).width+6;a.fillStyle="#333";e=Math.max(j.x-f/2,d.paddingLeft);e=Math.min(e,b.width-d.paddingRight-f);a.fillRect(e,j.bottom,f,20);a.textAlign="left";a.fillStyle="#ffffff";a.fillText(c,e+2,j.bottom+5)}a.restore();this.drawLabels(a)},drawLabels:function(a){var b=this.data.axis(),
d=b.y.name,c=b.x.name,f=b.x._lpath;b=b.y._lpath;a.save();a.font="10px Arial";a.fillStyle="#808080";a.textAlign="center";a.textBaseline="middle";c&&a.fillText(c,f.x,f.y);if(d){a.rotate(Math.PI/2);a.translate(b.x,b.y);a.fillText(d,0,0)}a.restore()}});return p},{requires:["chart/path"]});
KISSY.add("chart/chart",function(l,q,p,h,a,b,d){function c(){this.list=[];this.current_index=-1;this.init()}function f(e,g){if(!(this instanceof f))return new f(e,g);var k=this.elCanvas=l.one(e);if(k){this.width=parseInt(k.attr("width"),10);this.height=parseInt(k.attr("height"),10);this.elCanvas=k;this.ctx=-1;this.tooltip=chartManager.getTooltip();if(g){this.data=g;this._initContext()}chartManager.add(this)}}var j={left:40,top:40};l.augment(c,l.EventTarget,{add:function(e){var g=this,k;g.list.push(e);
k=g.list.length-1;e.on("active",function(){g.current_index!==k&&g.fire("focusChange");g.current_index=k})},remove:function(e){e.detach("mouseenter");l.each(self.list,function(g,k){if(g===k)self.list[k]=null})},getTooltip:function(){if(!this.tooltip)this.tooltip=new b;return this.tooltip},init:function(){l.one("body").on("mousemove",this._bodyMouseMove,this);return this},_bodyMouseMove:function(e){var g,k;if(this.current_index>-1)g=this.list[this.current_index];if(g){k=e.pageX-g.offset.left;e=e.pageY-
g.offset.top;k>0&&k<g.width&&e>0&&e<g.height?g.fire("mouse_move",{x:k,y:e}):g.fire("mouse_leave")}}});l.extend(f,l.Base,{render:function(e){var g=this;if(g.ctx==-1){g.data=e;g._initContext()}else if(g.ctx===0)g.data=e;else{g._data=new p(e);if(g._data){e=g._data;g.initChart();g._drawcfg=l.merge(j,e.config,{width:g.width,height:g.height});if(e.type==="bar"||e.type==="line"){g._drawcfg.max=e.axis().y.max||h.getMax(e.max(),g._drawcfg);g.axis=new h(e,g,g._drawcfg);g._frame=new a(g._data,g._drawcfg);g.layers.push(g.axis);
g.layers.push(g._frame)}g.element=d.getElement(g._data,g,g._drawcfg);g.layers.push(g.element);e=e.config;var k=g.ctx.createLinearGradient(0,0,0,g.height);g.backgroundFillStyle=null;if(e.backgroundStyle&&typeof e.backgroundStyle==="object"){k.addColorStop(0,e.backgroundStyle.start);k.addColorStop(1,e.backgroundStyle.end);g.backgroundFillStyle=k}else if(l.isString(e.backgroundStyle))g.backgroundFillStyle=e.backgroundStyle;setTimeout(function(){g._redraw();g.initEvent()},100)}}},_initContext:function(){var e=
this;if(typeof e.ctx!="object")if(e.elCanvas[0].getContext)setTimeout(function(){e.ctx=e.elCanvas[0].getContext("2d");e._contextReady()},0);else{e.ctx=0;e._count=typeof e._count=="number"?e._count-1:30;e._count>=0?setTimeout(function(){e._initContext()},50):l.one("<p class='ks-chart-error' >\u7cdf\u4e86\uff0c\u4f60\u7684\u6d4f\u89c8\u5668\u8fd8\u4e0d\u652f\u6301\u6211\u4eec\u7684\u56fe\u8868</p>").insertAfter(e.elCanvas)}},_contextReady:function(){this.data&&this.render(this.data)},loading:function(){this.showMessage("\u8f7d\u5165\u4e2d...")},showMessage:function(e){var g=this.ctx,k=this.width/
2,m=this.height/2;g.clearRect(0,0,this.width,this.height);g.save();g.font="12px Arial";g.textAlign="center";g.fillStyle="#808080";g.fillText(e,k,m);g.restore()},initChart:function(){this.layers=[];this._updateOffset();this.loading();l.each([this.element,this.axis],function(e){if(e){e.destory();e.detach()}});this.axis=this.element=null;if(this._event_inited){this.elCanvas.detach("mouseenter",this._mouseenterHandle).detach("mouseleave",this._mouseLeaveHandle);this.detach()}this.tooltip.hide()},initEvent:function(){var e=
this;e._event_inited=true;e.elCanvas.on("mouseenter",e._mouseenterHandle,e).on("mouseleave",e._mouseLeaveHandle,e);e.on("mouse_leave",e._drawAreaLeave,e);e.axis&&e.axis.on("xaxishover",e._xAxisHover,e).on("leave",e._xAxisLeave,e).on("redraw",e._redraw,e);e.element.on("redraw",e._redraw,e).on("showtooltip",function(g){g=l.isString(g.message)?g.message:g.message.innerHTML;e.tooltip.show(g)}).on("hidetooltip",function(){e.tooltip.hide()})},draw:function(){var e=this.ctx,g=this._drawcfg;if(this.backgroundFillStyle){e.fillStyle=
this.backgroundFillStyle;e.fillRect(0,0,g.width,g.height)}else e.clearRect(0,0,g.width,g.height);l.each(this.layers,function(k){k.draw(e,g)})},ctx:function(){if(this.ctx)return this.ctx;if(this.elCanvas[0].getContext)return this.ctx=this.elCanvas.getContext("2d");else return null},_redraw:function(){this._redrawmark=true;this._running||this._run()},_run:function(){var e=this;clearTimeout(e._timeoutid);e._running=true;e._redrawmark=false;e._timeoutid=setTimeout(function(){e.draw();if(e._redrawmark)e._run();
else e._running=false},1E3/24)},_xAxisLeave:function(){this.fire("axisleave")},_xAxisHover:function(e){this.fire("axishover",{index:e.index,x:e.x});this._redraw()},_drawAreaLeave:function(){this.tooltip.hide()},_mouseenterHandle:function(){this._updateOffset();this.fire("active")},_updateOffset:function(){return this.offset=this.elCanvas.offset()},_mouseLeaveHandle:function(){this.fire("mouse_leave")}});chartManager=window.chartManager=new c;return l.Chart=f},{requires:["chart/util","chart/data",
"chart/axis","chart/frame","chart/simpletooltip","chart/element"]});
KISSY.add("chart/data",function(l,q){function p(b){if(b&&b.type){if(!this instanceof p)return new p(b);var d=b.config;this.origin=b;b=l.clone(b);this.type=b.type.toLowerCase();this.config=d=l.merge(h,a[this.type],d);l.each({left:"paddingLeft",top:"paddingTop",bottom:"paddingBottom",right:"paddingRight"},function(c,f){if(f in d&&l.isNumber(d[f]))d[c]=d[f]});this._elements=this._expandElement(this._initElement(b));this._initElementItem();this._axis=b.axis}}var h={paddingTop:30,paddingLeft:20,paddingRight:20,
paddingBottom:20,showLabels:true,colors:[],animationDuration:0.5,animationEasing:"easeInStrong",backgroundStyle:false,axisTextColor:"#999",axisBackgroundColor:"#EEE",axisGridColor:"#e4e4e4",numberFormat:null,frameColor:"#d7d7d7"},a={line:{drawbg:-1},bar:{},pie:{animationDuration:1.8,animationEasing:"bounceOut",paddingTop:10,paddingBottom:10,paddingLeft:10,paddingRight:10,drawShadow:true,shadow:{blur:3,color:"#000"},labelTemplate:"{name} {pecent}%",firstPieOut:false}};l.augment(p,{axis:function(){return this._axis},
elements:function(){return this._elements},maxElementLength:function(){var b=0;l.each(this._elements,function(d){b=l.isArray(d.items)?Math.max(b,d.items.length):Math.max(b,1)});return b},getColor:function(b,d){var c=this._elements.length,f=this.config.colors;if(l.isArray(f)&&f[b])return f[b];if(l.isFunction(f))return f(b);return this.getDefaultColor(b,c,d)},sum:function(){var b=0;this.eachElement(function(d){b+=d.data});return b},max:function(){return this._max},getDefaultColor:function(b,d){var c=
1/3,f=c*b,j,e;if(b<3)f=c*b+0.05;else{if(d%3==0)if(b===d-1)b=d-2;else if(b===d-2)b=d-1;f=b%3;j=Math.ceil(d/3);e=Math.ceil((b+1)/3);f=f*c+c/j*(e-1)}return q.Color.hsl(f,0.7,0.65).hexTriplet()},eachElement:function(b){l.each(this._elements,function(d,c){d.items?l.each(d.items,function(f,j){b(f,c,j)}):b(d,c,-1)})},_initElement:function(b){var d=null,c;if(b.elements&&l.isArray(b.elements))d=l.clone(b.elements);if(!b.elements&&b.element&&l.isArray(b.element.names)){d=[];c=b.element;l.each(c.names,function(f,
j){d.push({name:f,data:l.isArray(c.datas)?c.datas[j]:null,label:l.isArray(c.labels)?c.labels[j]:c.label})})}return d},_expandElement:function(b){l.each(b,function(d){if(l.isArray(d.datas)){d.items=[];l.each(d.datas,function(c,f){var j={name:d.name,data:c};j.label=l.isArray(d.labels)?d.labels[f]:d.label;d.items.push(j)})}});return b},_initElementItem:function(){var b=this;b._max=0;b.eachElement(function(d,c,f){if(c===0&&!f)b._max=d.data||0;d.data=l.isNumber(d.data)?d.data:0;b._max=Math.max(b._max,
d.data);if(l.isArray(b.config.numberFormat))d.format=b.config.numberFormat[c];else if(l.isString(b.config.numberFormat))d.format=b.config.numberFormat;if(typeof d.format=="undefined")d.format=b.config.numberFormat;d.label=l.substitute(typeof d.label==="undefined"?null:d.label,{name:d.name,data:d.format?q.numberFormat(d.data,d.format):d.data})})}});return p},{requires:["chart/util"]});
KISSY.add("chart/element",function(l,q,p,h){function a(){}l.mix(a,{getElement:function(b,d,c){var f;switch(b.type){case "line":f=h;break;case "pie":f=q;break;case "bar":f=p}return new f(b,d,c)},getMax:function(b){var d=b[0].data[0],c,f=b.length,j,e;for(c=0;c<f;c++){element=b[c];j=0;for(e=element.data.length;j<e;j++)d=Math.max(d,element.data[j]||0)}return d}});l.augment(a,l.EventTarget,{drawNames:function(b){var d=this.drawcfg,c=this.data.elements(),f=c.length-1,j=d.width-d.paddingRight;d=d.paddingTop-
12;for(var e,g;f>=0;f--){e=c[f];if(!e.notdraw){g=this.data.getColor(f);b.save();b.textAlign="end";b.textBaseline="middle";b.fillStyle="#808080";b.font="12px Arial";b.fillText(e.name,j,d);j-=b.measureText(e.name).width+10;b.restore();b.save();b.beginPath();b.fillStyle=g;b.arc(j,d,5,0,Math.PI*2,true);b.closePath();b.fill();b.restore();j-=10}}},init:function(){},destory:function(){},draw:function(){}});return a},{requires:["chart/element_pie","chart/element_bar","chart/element_line"]});
KISSY.add("chart/element_bar",function(l,q,p){function h(a,b,d){this.data=a;this.chart=b;this.drawcfg=d;this.config=a.config;this.initData(d);this.initEvent();this.current=[-1,-1];this.anim=new q.Anim(this.config.animationDuration,this.config.animationEasing);this.anim.init()}l.augment(h,l.EventTarget,{initData:function(a){var b=this,d=b.data,c=d.elements().length;d=d.maxElementLength();var f=a.paddingLeft,j=a.height-a.paddingBottom,e=(a.width-a.paddingRight-f)/d,g=e/5/c,k=e/3/c,m=(e-(c-1)*g-2*k)/
c,n,o,t,r,u=[];b.maxLength=d;b.items=u;b.data.eachElement(function(y,s,v){if(v===-1)v=0;u[s]||(u[s]={_x:[],_top:[],_left:[],_path:[],_width:[],_height:[],_colors:[],_dcolors:[],_labels:[]});var w=u[s];n=(j-a.top)*y.data/a.max;o=f+v*e+k+s*(m+g);t=j-n;r=q.Color(b.data.getColor(s,"bar"));s=r.hslData();var z=s[2],A=s[1];z=(z+A/2)*0.6-A/2;colord=new q.Color.hsl(s[0],A,z);w._left[v]=o;w._top[v]=t;w._width[v]=m;w._height[v]=n;w._path[v]=new p.RectPath(o,t,m,n);w._x[v]=o+m/2;w._colors[v]=r;w._dcolors[v]=
colord;w._labels[v]=y.label})},draw:function(a){var b=this,d=b.items,c=b.maxLength,f,j,e,g,k,m,n=b.anim.get(),o;b.data.config.showLabels&&b.drawNames(a);l.each(d,function(t,r){for(o=0;o<c;o++){k=t._left[o];e=t._height[o];g=e*n;m=t._top[o]+e-g;barwidth=t._width[o];f=t._colors[o];dcolor=t._dcolors[o];j=a.createLinearGradient(k,m,k,m+g);j.addColorStop(0,f.css());j.addColorStop(1,dcolor.css());a.fillStyle=j;a.fillRect(k,m,barwidth,g);if(c===1&&e>25){a.save();a.fillStyle="#fff";a.font="20px bold Arial";
a.textBaseline="top";a.textAlign="center";d=b.data.elements()[r];a.fillText(q.numberFormat(d.data,d.format),t._x[o],m+2);a.restore()}}});n<1&&b.fire("redraw")},initEvent:function(){this.chart.on("mouse_move",this.chartMouseMove,this);this.chart.on("mouse_leave",this.chartMouseLeave,this)},destory:function(){this.chart.detach("mouse_move",this.chartMouseMove);this.chart.detach("mouse_leave",this.chartMouseLeave)},chartMouseMove:function(a){var b=[-1,-1],d=this.items;l.each(this.items,function(c,f){l.each(c._path,
function(j,e){if(j.inpath(a.x,a.y))b=[f,e]})});if(!(b[0]===this.current[0]&&b[1]===this.current[1])){this.current=b;if(b[0]+b[1]>=0){this.fire("barhover",{index:b});this.fire("showtooltip",{top:d[b[0]]._top[b[1]],left:d[b[0]]._x[b[1]],message:this.getTooltip(b)})}else this.fire("hidetooltip")}},chartMouseLeave:function(){this.current=[-1,-1]},getTooltip:function(a){var b=a[1];a=this.items[a[0]];return"<div class='bartip'><span style='color:"+a._colors[b].css()+";'>"+a._labels[b]+"</span></div>"},
drawNames:function(a){var b=this.drawcfg,d=this.data.elements(),c=d.length-1,f=b.width-b.paddingRight;b=b.paddingTop-12;for(var j,e;c>=0;c--){j=d[c];if(!j.notdraw){e=this.data.getColor(c);a.save();a.textAlign="end";a.textBaseline="middle";a.fillStyle="#808080";a.font="12px Arial";a.fillText(j.name,f,b);f-=a.measureText(j.name).width+10;a.restore();a.save();a.beginPath();a.fillStyle=e;a.arc(f,b,5,0,Math.PI*2,true);a.closePath();a.fill();a.restore();f-=10}}}});return h},{requires:["chart/util","chart/path"]});
KISSY.add("chart/element_line",function(l,q){function p(h,a,b){this.chart=a;this.data=h;this.elements=h.elements();this._current=-1;this.config=h.config;this.drawcfg=b;this.initdata(b);this._ready_idx=-1;this.init();this.anim=new q.Anim(this.config.animationDuration,this.config.animationEasing);this.anim.init()}l.augment(p,l.EventTarget,{initdata:function(h){var a=this.data,b=a.maxElementLength(),d=h.paddingLeft,c=h.height-h.paddingBottom,f=c-h.paddingTop,j=(h.width-h.paddingRight-d)/(b-1),e=[];this.items=
e;a.eachElement(function(g,k,m){e[k]||(e[k]={_points:[],_labels:[],_color:a.getColor(k),_maxtop:c,_drawbg:k===a.config.drawbg});k=e[k];ptop=Math.max(c-g.data/h.max*f,h.paddingTop-5);k._maxtop=Math.min(k._maxtop,ptop);k._labels[m]=g.label;k._points[m]={x:d+j*m,y:ptop,bottom:c}})},draw:function(h,a){var b=this,d=b.data,c=a.paddingLeft,f=a.width-a.paddingRight,j=a.height-a.paddingBottom,e,g,k,m,n,o,t=b.anim.get(),r;d.config.showLabels&&b.drawNames(h,a);if(t>=1&&this._ready_idx<b.items.length-1){b._ready_idx++;
b.anim.init();t=b.anim.get()}if(this._ready_idx!==d.elements().length-1||t!==1)this.fire("redraw");l.each(b.items,function(u,y){var s;o=y!==b._ready_idx?y>b._ready_idx?0:1:t;e=u._color;k=u._points;if(u._drawbg){h.save();h.globalAlpha=0.4;maxtop=j-(j-u._maxtop)*o;r=h.createLinearGradient(c,maxtop,c,j);r.addColorStop(0,e);r.addColorStop(1,"rgb(255,255,255)");h.fillStyle=r;h.beginPath();h.moveTo(c,j);for(m=0;m<k.length;m++){s=k[m];g=j-(j-s.y)*o;h.lineTo(s.x,g)}h.lineTo(f,j);h.stroke();h.fill();h.restore()}h.save();
n=k.length;h.strokeStyle=e;h.lineWidth=2;h.beginPath();for(m=0;m<n;m++){s=k[m];g=j-(j-s.y)*o;m===0?h.moveTo(s.x,g):h.lineTo(s.x,g)}h.stroke();h.restore();h.save();for(m=0;m<n;m++){s=k[m];g=j-(j-s.y)*o;h.fillStyle=e;h.beginPath();h.arc(s.x,g,5,0,Math.PI*2,true);h.closePath();h.fill();if(m!==b._current){h.fillStyle="#fff";h.beginPath();h.arc(s.x,g,3,0,Math.PI*2,true);h.closePath();h.fill()}}h.restore()})},init:function(){this._ready_idx=0;this.chart.on("axishover",this._axis_hover,this);this.chart.on("axisleave",
this._axis_leave,this)},destory:function(){this.chart.detach("axishover",this._axis_hover);this.chart.detach("axisleave",this._axis_leave)},_axis_hover:function(h){h=h.index;if(this._current!==h){this._current=h;this.fire("redraw");this.fire("showtooltip",{message:this.getTooltip(h)})}},_axis_leave:function(){this._current=-1;this.fire("redraw")},getTooltip:function(h){var a,b;a="<ul>";l.each(this.items,function(d){b="<li><p style='color:"+d._color+"'>"+d._labels[h]+"</p></li>";a+=b});a+="</ul>";
return a},drawNames:function(h){var a=this.drawcfg,b=this.data.elements(),d=b.length-1,c=a.width-a.paddingRight;a=a.paddingTop-12;for(var f,j;d>=0;d--){f=b[d];if(!f.notdraw){j=this.data.getColor(d);h.save();h.textAlign="end";h.textBaseline="middle";h.fillStyle="#808080";h.font="12px Arial";h.fillText(f.name,c,a);c-=h.measureText(f.name).width+10;h.restore();h.save();h.beginPath();h.fillStyle=j;h.arc(c,a,5,0,Math.PI*2,true);h.closePath();h.fill();h.restore();c-=10}}}});return p},{requires:["chart/util"]});
KISSY.add("chart/element_pie",function(l,q){function p(a){if(l.isString(a))a=q.Color(a);a=a.hslData();var b=a[1],d=a[2];d=(d+b*0.5)*1.05-b*0.5;return new q.Color.hsl(a[0],b,d)}function h(a,b,d){this.data=a;this.chart=b;this.type=0;this.config=a.config;this.drawcfg=d;this.initdata(d);this.init();this.anim=new q.Anim(this.config.animationDuration,this.config.animationEasing);this.anim.init()}l.augment(h,l.EventTarget,{initdata:function(a){var b=this,d=b.data,c=0,f,j,e,g;b._x=d.config.showLabels?a.width*
0.618/2:a.width/2;b._y=a.height/2;b._r=Math.min(a.height-a.paddingTop-a.paddingBottom,a.width-a.paddingLeft-a.paddingRight)/2;b._r=Math.min(b._r,b._x-a.paddingLeft);b._lx=a.width*0.618;b.angleStart=-Math.PI/4;b.antiClock=true;b.items=[];b._currentIndex=-1;c=d.sum();g=0;l.each(d.elements(),function(k,m){e=k.data/c;f=g+e;j=d.getColor(m);b.items.push({start:g,end:f,color:j,color2:p(j).css(),textColor:"#999",labelRight:a.width-50,labelY:50+20*m});g=f;if(m===0)b.angleStart+=e*Math.PI})},drawLabels:function(a){var b=
this,d=b.data,c=b.items,f,j=d.sum(),e,g,k;a.save();a.textBaseline="middle";a.textAlign="right";d.eachElement(function(m,n){f=c[n];k=f.labelY;g=f.labelRight;a.fillStyle=c[n].color;a.beginPath();a.moveTo(g,k);a.font="15px sans-serif";a.fillRect(g-10,k-5,10,10);a.closePath();a.fillStyle=c[n].textColor;e=l.substitute(b.config.labelTemplate,{data:q.numberFormat(m.data,m.format),name:m.name,pecent:q.numberFormat(m.data/j*100,"0.00")});a.fillText(e,g-15,k)});a.restore()},draw:function(a){var b=this,d=b._x,
c=b._y,f=b._r,j,e,g=b.anim.get(),k=b.data.config;g<1&&b.fire("redraw");k.showLabels&&b.drawLabels(a);a.save();if(k.drawShadow){a.shadowBlur=k.shadow.blur;a.shadowColor=k.shadow.color}a.save();a.lineWidth=0.5;a.strokeStyle="#fff";l.each(b.items,function(m,n){j=m.start*g*2*Math.PI;e=m.end*g*2*Math.PI;a.save();a.fillStyle=n===b._currentIndex?m.color2:m.color;a.beginPath();m._currentStart=b.antiClock?b.angleStart-j:b.angleStart+j;m._currentEnd=b.antiClock?b.angleStart-e-0.0050:b.angleStart+e+0.0050;if(n===
0&&g>=1&&k.firstPieOut){a.moveTo(d+2,c-2);a.arc(d+2,c-2,f,m._currentStart,m._currentEnd,b.antiClock)}else{a.moveTo(d,c);a.arc(d,c,f,m._currentStart,m._currentEnd,b.antiClock)}a.closePath();a.fill();a.restore()});a.restore();a.restore()},init:function(){this.chart.on("mouse_move",this.chartMouseMove,this);this.chart.on("mouse_leave",this.chartMouseLeave,this)},destory:function(){this.chart.detach("mouse_move",this.chartMouseMove);this.chart.detach("mouse_leave",this.chartMouseLeave)},chartMouseMove:function(a){var b=
this._r,d=a.x-this._x,c=a.y-this._y,f;a=this.items;if(d*d+c*c>b*b){this.fire("hidetooltip");this._currentIndex=-1;this.fire("redraw")}else{if(d!=0){b=Math.atan(c/d);if(c<0&&d>0)b+=2*Math.PI;if(d<0)b+=Math.PI}else b=c>=0?Math.PI/2:3*Math.PI/2;for(i=a.length-1;i>=0;i--){c=a[i];d=c._currentStart;c=c._currentEnd;if(d>c){f=d;d=c;c=f}f=c-d;d%=Math.PI*2;if(d<0)if(d+f<0||b>Math.PI)d+=Math.PI*2;if(b>d&&b<d+f&&i!==this._currentIndex){this._currentIndex=i;this.fire("redraw");this.fire("showtooltip",{message:this.data.elements()[i].label})}}}},
chartMouseLeave:function(){this._currentIndex=-1;this.fire("hidetooltip");this.fire("redraw")}});return h},{requires:["chart/util"]});KISSY.add("chart/frame",function(l,q){function p(h,a){this.data=h;this.path=new q.RectPath(a.paddingLeft,a.paddingTop,a.width-a.paddingRight-a.paddingLeft,a.height-a.paddingBottom-a.paddingTop)}l.augment(p,{draw:function(h){h.save();h.strokeStyle=this.data.config.frameColor;h.lineWidth=2;this.path.draw(h);h.stroke();h.restore()}});return p},{requires:["chart/path"]});
KISSY.add("chart",function(l,q){return q},{requires:["chart/chart"]});
KISSY.add("chart/path",function(l){function q(){}function p(a,b,d,c){this.rect={x:a,y:b,w:d,h:c}}function h(a,b,d,c,f,j){this._arc={x:a,y:b,r:d,b:c,e:f,a:j}}l.augment(q,{draw:function(){},inpath:function(){}});l.extend(p,q,{draw:function(a){var b=this.rect;a.beginPath();a.rect(b.x,b.y,b.w,b.h)},inpath:function(a,b){var d=this.rect,c=d.x,f=d.y,j=c+d.w;d=f+d.h;return a>c&&a<j&&b>f&&b<d}});l.extend(h,q,{draw:function(a){var b=this._arc;a.beginPath();a.moveTo(b,x,b.y);a.arc(b.x,b.y,b.r,b.b,b.e,b.a);a.closePath()},
inpath:function(a,b,d){if(d){this.draw(d);return d.isPointInPath(a,b)}b=this._arc;d=a-b.x;a=a-b.y;if(!(Math.pow(d,2)+Math.pow(a,2)<=Math.pow(b.r,2)))return false;if(d===0)if(a===0)return false;else da=a>0?Math.PI/2:Math.PI*1.5}});return{Path:q,RectPath:p,ArcPath:h}});
KISSY.add("chart/simpletooltip",function(l){function q(){var p=this;p.n_c=l.all("<div class='ks-chart-tooltip'>");p._offset={left:0,top:0};p.hide();l.ready(function(){l.one("body").append(p.n_c).on("mousemove",p._mousemove,p)})}l.augment(q,{_mousemove:function(p){var h=p.pageX;p=p.pageY;if(this._show)this._updateOffset(h,p);else{this._offset.left=h;this._offset.top=p}},_updateOffset:function(p,h){var a=l.DOM;if(p>a.scrollLeft()+a.viewportWidth()-100)p-=this.n_c.width()+6;if(h>a.scrollTop()+a.viewportHeight()-
100)h-=this.n_c.height()+20;this.n_c.offset({left:p,top:h+12})},show:function(p){this._show=true;this.n_c.html(p).css("display","block")},hide:function(){this._show=false;this.n_c.css("display","none")},_init:function(){}});return q});
KISSY.add("chart/util",function(l){function q(h,a){this.duration=h*1E3;this.fnEasing=l.isString(a)?l.Easing[a]:a}var p=function(){var h=function c(f,j,e,g){var k=arguments.length;if(k<3){if(typeof f==="string"){f=f.substr(f.indexOf("#")+1);var m=f.length===3;f=parseInt(f,16);m&&(f=(f&3840)*4352|(f&240)*272|(f&15)*17)}k===2&&(g=j);j=(f&65280)/256;e=f&255;f>>>=16}if(!(this instanceof c))return new c(f,j,e,g);this.channels=[typeof f==="string"&&parseInt(f,16)||f,typeof j==="string"&&parseInt(j,16)||
j,typeof e==="string"&&parseInt(e,16)||e,typeof g!=="string"&&typeof g!=="number"&&1||typeof g==="string"&&parseFloat(g)||g]},a=h.prototype,b=Math,d;h.RGBtoHSL=function(c){var f=c[0],j=c[1];c=c[2];f/=255;j/=255;c/=255;var e=b.max(f,j,c),g=b.min(f,j,c),k,m=(e+g)/2;if(e===g)k=g=0;else{var n=e-g;g=m>0.5?n/(2-e-g):n/(e+g);switch(e){case f:k=(j-c)/n+(j<c?6:0);break;case j:k=(c-f)/n+2;break;case c:k=(f-j)/n+4}k/=6}return[k,g,m]};h.HSLtoRGB=function(c){var f=c[0],j=c[1],e=c[2];c=function(m,n,o){if(o<0)o+=
1;if(o>1)o-=1;if(o<1/6)return m+(n-m)*6*o;if(o<0.5)return n;if(o<2/3)return m+(n-m)*(2/3-o)*6;return m};if(j===0)j=e=f=e;else{var g=e<0.5?e*(1+j):e+j-e*j,k=2*e-g;j=c(k,g,f+1/3);e=c(k,g,f);f=c(k,g,f-1/3)}return[j*255,e*255,f*255]};h.rgb=function(c,f,j,e){return new h(c,f,j,typeof e!=="undefined"?e:1)};h.hsl=function(c,f,j,e){c=h.HSLtoRGB([c,f,j]);f=b.ceil;return new h(f(c[0]),f(c[1]),f(c[2]),typeof e!=="undefined"?e:1)};h.TO_STRING_METHOD="hexTriplet";h.parse=function(c){c=c.replace(/^\s+/g,"").toLowerCase();
if(c[0]==="#")return new h(c);var f=c.substr(0,3),j;c=c.replace(/[^\d,.]/g,"").split(",");for(j=c.length;j--;)c[j]=c[j]&&parseFloat(c[j])||0;switch(f){case "rgb":return h.rgb.apply(h,c);case "hsl":c[0]/=360;c[1]/=100;c[2]/=100;return h.hsl.apply(h,c)}return null};(h.clearColors=function(){d={transparent:[0,0,0,0]}})();h.define=function(c,f){d[c.toLowerCase()]=f};h.get=function(c){c=c.toLowerCase();if(Object.prototype.hasOwnProperty.call(d,c))return h.apply(null,[].concat(d[c]));return null};h.del=
function(c){return delete d[c.toLowerCase()]};h.random=function(c,f){typeof c==="string"&&(c=h.get(c))&&(c=c.getValue());typeof f==="string"&&(f=h.get(f))&&(f=f.getValue());var j=b.floor,e=b.random;f=(f||16777215)+1;if(!isNaN(c))return new h(j(e()*(f-c)+c));return new h(j(e()*f))};a.toString=function(){return this[h.TO_STRING_METHOD]()};a.valueOf=a.getValue=function(){var c=this.channels;return c[0]*65536|c[1]*256|c[2]};a.setValue=function(c){this.channels.splice(0,3,c>>>16,(c&65280)/256,c&255)};
a.hexTriplet="01".substr(-1)==="1"?function(){return"#"+("00000"+this.getValue().toString(16)).substr(-6)}:function(){var c=this.getValue().toString(16);return"#"+Array(c.length<6?6-c.length+1:0).join("0")+c};a.css=function(){return this.channels[3]===1?this.hexTriplet():this.rgba()};a.rgbData=function(){return this.channels.slice(0,3)};a.hslData=function(){return h.RGBtoHSL(this.rgbData())};a.rgb=function(){return"rgb("+this.rgbData().join(",")+")"};a.rgba=function(){return"rgba("+this.channels.join(",")+
")"};a.hsl=function(){var c=this.hslData();return"hsl("+c[0]*360+","+c[1]*100+"%,"+c[2]*100+"%)"};a.hsla=function(){var c=this.hslData();return"hsla("+c[0]*360+","+c[1]*100+"%,"+c[2]*100+"%,"+this.channels[3]+")"};return h}();l.augment(q,{init:function(){this.start=(new Date).getTime();this.finish=this.start+this.duration},get:function(){var h=(new Date).getTime();if(h>this.finish)return 1;return this.fnEasing((h-this.start)/this.duration)}});return{Color:p,numberFormat:function(h,a){if(typeof a===
"string"){var b=-1<a.indexOf(","),d=a.split(".");if(1<d.length)h=h.toFixed(d[1].length);else if(2<d.length)throw"NumberFormatException: invalid format, formats should have no more than 1 period:"+a;else h=h.toFixed(0);var c=h.toString();if(b){d=c.split(".");b=d[0];c=[];for(var f=b.length,j=Math.floor(f/3),e=b.length%3||3,g=0;g<f;g+=e){if(g!=0)e=3;c[c.length]=b.substr(g,e);j-=1}c=c.join(",");if(d[1])c+="."+d[1]}return a.replace(/[\d,?\.?]+/,c)}},Anim:q}});
